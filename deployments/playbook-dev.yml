# code: language=ansible
---
- name: Deploy API Development
  hosts: all
  become: true

  vars:
    app_env: development
    ansible_user: konsulin
    ansible_python_interpreter: /usr/bin/python3.12
    docker_service_name: dev-api
    deployment_path: "/home/konsulin/infrastructure/development/konsulin-app"
    deployment_env: "develop"
    config_file_name: "config.development.yaml"

    image_repository: konsulin/api-service
    image_tag: ""

    logging:
      driver: "json-file"
      options:
        maxSize: "200k"
        maxFile: "10"

    domain:
      virtual_host: dev-api.konsulin.care
      letsencrypt_host: dev-api.konsulin.care
      letsencrypt_email: mfardiansyah.id@gmail.com

    internal_config:
      app:
        env: "development"
        port: 3001
        version: "v1"
        address: "0.0.0.0"
        base_url: "https://dev-api.konsulin.care/"
        timezone: "Asia/Jakarta"
        endpoint_prefix: "api"
        reset_password_url: "https://dev-app.konsulin.care/reset-password-form?token="
        max_requests: 15
        shutdown_timeout_in_seconds: 3
        max_time_requests_per_seconds: 30
        request_body_limit_in_megabyte: 30
        account_deactivation_age_in_days: 30
        login_session_expired_time_in_hours: 2
        forgot_password_token_expired_time_in_minutes: 2
        minio_pre_signed_url_object_expiry_time_in_hours: 1
        questionnaire_guest_response_response_expired_time_in_minutes: 10

      fhir:
        base_url: "https://dev-blaze.konsulin.care/fhir/"

      jwt:
        secret: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          38366361353437396132393161656561626131363261663732396238656339616233306163343066
          6265303163316138353334653836356133653330373634370a323263396232643334643539643934
          32656635386636386535666464616437643532356465356535656366666164336565613064393530
          6336343039393033310a396539663636646564663863633938666162333935663566323739303339
          66313035346265636131663231343235663236356532633839613839383432633335
        exp_time_in_hour: 1
      mailer:
        email_sender: "funlab.ardihikaru@gmail.com"
      minio:
        profile_picture_max_upload_size_in_mb: 2
        bucket_name: "konsulin-dev"
      rabbitmq:
        mailer_queue: "dev.email"
        whatsapp_queue: "dev.whatsapp"
      mongodb:
        fhir_db_name: "spark"
        konsulin_db_name: "konsulin"
    driver_config:
      mongodb:
        port: 17017
        host: "37.27.46.214"
        username: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          32633234383766396336303061343338333265633631366466373639356539323533353637376563
          3030656330316365633339623238616234333139323635370a643035623338346530353934333965
          63656332323761373533306238376238336430303030616335383038373362626233303338636136
          3136303834646439380a353262303832373665326231343739383262363736343663363030326539
          3339
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          64386334316530666334303461353039653066636266316538623466386562386638343362356533
          6237303162656165653636313930343064643538663837370a366236313766363838633264633133
          63363563383539343966383037343332376231616533383735306136343262373962633231323266
          3934303061353835300a323562353131333166303230636530356337613337623636653066303635
          31633362323466313662623337393230303032343337336663616231643133366630

      redis:
        host: "37.27.46.214"
        port: 6379
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          33393338343262303137656138376363306266383363326237353730356261623965393936656135
          3362323165613036656266633339333739306462363931640a383565343963373563306333613837
          38326131373934396266373263653430613534613362383364306161646365333334316664313233
          3831353563373465350a373937386533663238653063623930646636643130383266333831353266
          63373332393661393831333636383939343263623430643035646136343861353966

      logger:
        level: "debug"
        output_file_name: "logger.log"
        output_error_file_name: "logger_error.log"

      rabbitmq:
        port: 5672
        host: "37.27.46.214"
        username: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          38303731346163366233633632633663313338353663613863646364393131396262616663366239
          3032616136323732313362303635323936396539613038620a346561316136636239643566366662
          31323063383337396230643030376639366538613631316263333934613735333662323533383030
          3262376262623936650a393234633535656136386330656132646237613133353730656466663432
          6561
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          31353935383765333833336332376536613530363833356636653437303633343939363033653830
          3031313532663839313563323166623836323331613632340a306164643364303535626437656632
          33663639393961373133643864336463373464613239356663366435646235653662376531633366
          3639353339383431350a633065346434303963643738303039386362353066303865623030353965
          32333631623638343664633931383334356365316238616636353538653562636336

      minio:
        port: 443
        host: "s3.konsulin.care"
        use_ssl: "true"
        username: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          36646531313630363139303361613463383938366237396136623930643961343330346237643035
          3434653339633832656463336637386235343533353562360a336561643166663233616233376231
          64346332316432303933393730383431353462373365613736643466363737356232356531646531
          3037313932646430370a336361363233323237653165636239616535623562643835313338316533
          66313861356335646139633534383565303538386462643236396132343635613266
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          31353839323035633866346637383736363432653366323733353235306432643433353231396237
          6163636132366161353563386361343934336166353636390a346264373763643636363765303731
          30363235336232343965663937383933323037333332653633373433613965623133323462316362
          6136363430373739360a306637316563363932323435313266643536386130313030393831373636
          30643438316432333737333636386633316266343862623335343236316234393230623734313730
          6131356261633430383632306332633262346363623136383931

      postgres:
        port: 5554
        host: "37.27.46.214"
        username: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          32616231613465626261366266346337346334346562356366616231303165326630323431356466
          3164666433636531303863663335313533373965353462320a303030353136336665356666643965
          37656364613031636635623265653334303838306463636163346234623737343062633762343238
          3534623364646163300a383139313764303062663136646664383437656363316663616334353931
          3264
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          35646334663834633430363135336135333062316131373963333030653631336633333933333863
          3762393164396133393465303536623530323533623537350a663130633163376365366539343633
          33353465633066636330646433303739643732323433396366356437323434353161323838346135
          3064383836666265370a363132663362353231303931363336306334333039313735613137386564
          3362
        dbname: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          65653066396531313236316364643339663861346431353430333035303363303832643433323931
          6637333563613832613839343739623564316132313936330a633364366136353130376231623866
          34366662343037356262376532303461663234626530383462383661383165383866373463636135
          3732623230323965640a613039396638313038616530313264353063383938343533623665633131
          3332

      kafka:
        host: "37.27.46.214"
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          38373066613764643837363766323237643139613239663533343934323738663964303038653236
          3565383435656537353731303437326234313536386464340a326264313065383536663338623961
          39346435353831316366333535623932313337366237663236633237373836333438626539383364
          3565353131353331340a653632373334376661626338383561386339343865663534633165653664
          3864

  tasks:
    - name: Include deployment tasks
      include_tasks: deploy-task.yml
